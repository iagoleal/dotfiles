#!/bin/sh

FOLDER="$(realpath "$1")"

finder() {
  fzfmenu -T 'Book Searcher' \
          -C 'FloatMenu'    \
    --prompt="Î² " --scheme=path --info=inline
}

spawn() {
  herbstclient spawn xdg-open "$@"
}

item=$(cd "$FOLDER" && rg --files | sed "s:^\./::g" | finder)
exit_code=$?
item_path="$FOLDER/$item"

if [ $exit_code == 0 ]; then
  spawn "$item_path"
else
  exit "$exit_code"
fi
